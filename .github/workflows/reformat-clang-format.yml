name: Reformat C/C++ code using Clang-format

# Don't trigger it on pull_request events but issue_comment instead
on: issue_comment

jobs:
  reformat-clang-format:
    # Trigger the job only when someone comments - Reformat: Clang-format
    if: ${{ github.event.issue.pull_request && contains(github.event.comment.body, 'Reformat:\ Clang-format') }}
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout project
        uses: actions/checkout@v2

      - name: clang-format lint
        uses: DoozyX/clang-format-lint-action@v0.11
        with:
          inPlace: true

      - uses: EndBug/add-and-commit@v7.1.1
        with:
          author_name: Clang-Format Bot
          author_email: robot@example.com
          message: 'style: format *.{c,h} files with clang-format'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
